<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="*"
           Name="Visual Rust"
           Language="1033"
           Version="0.2.0.0"
           Manufacturer="The Piston Project"
           UpgradeCode="{B5CC88F7-BC23-4400-95D8-9EE3FA95CC3F}">
    <Package InstallerVersion="400"
             Compressed="yes"
             InstallScope="perMachine" />

    <WixVariable Id="WixUILicenseRtf" Value="..\LICENSE.rtf" />

    <UIRef Id="WixUI_FeatureTree" />

    <MajorUpgrade DowngradeErrorMessage="A newer version of Visual Rust is already installed." />
    <MediaTemplate EmbedCab="yes" CompressionLevel="high" />


    <Property Id="VSLAUNCHER" >
      <DirectorySearch Path="[ProgramFilesFolder]\Common Files\Microsoft Shared\MSEnv" Depth="4" Id="FindVSLauncher">
        <FileSearch Name="VSLauncher.exe" />
      </DirectorySearch>
    </Property>

    <Feature Id="Ftr_MSBuild_Integration"
             Title="MSBuild integration"
             Description="MSBuild tasks and targets. This feature is required for building Visual Rust projects from command line and Visual Studio."
             Level="1"
             Absent="disallow">
      <ComponentGroupRef Id="CmpGroup_MSBuild" />
      <ComponentGroupRef Id="CmpGroup_MSBuild_Integration_XamlRules" />
    </Feature>

    <PropertyRef Id="VS2015DEVENV" />
    <Feature Id="Ftr_VisualRust.2015"
         Title="Visual Studio 2015 extension"
         Description="Extension for Visual Studio 2015. Provides support for Rust projects."
         Level="1000">
      <Condition Level="1">
        <!-- This is not fully satisfying because the user can still enable it, but I hope most of our users are smarter than that  -->
        <![CDATA[Installed OR VS2015DEVENV]]>
      </Condition>
      <ComponentGroupRef Id="CmpGroup_vsx.2015"/>
      <ComponentGroupRef Id="CmpGroup_gdb.2015.i686"/>
      <ComponentGroupRef Id="CmpGroup_gdb.2015.x86_64"/>
      <ComponentGroupRef Id="CmpGroup_item_templates.2015"/>
      <ComponentGroupRef Id="CmpGroup_proj_templates.2015"/>
    </Feature>

    <PropertyRef Id="VS2017DEVENV" />
    <Feature Id="Ftr_VisualRust.2017"
         Title="Visual Studio 2017 extension"
         Description="Extension for Visual Studio 2017. Provides support for Rust projects."
         Level="1000">
      <Condition Level="1">
        <!-- This is not fully satisfying because the user can still enable it, but I hope most of our users are smarter than that  -->
        <![CDATA[Installed OR VS2017DEVENV]]>
      </Condition>
      <ComponentGroupRef Id="CmpGroup_vsx.2017"/>
      <ComponentGroupRef Id="CmpGroup_gdb.2017.i686"/>
      <ComponentGroupRef Id="CmpGroup_gdb.2017.x86_64"/>
      <ComponentGroupRef Id="CmpGroup_item_templates.2017"/>
      <ComponentGroupRef Id="CmpGroup_proj_templates.2017"/>
    </Feature>
  </Product>
</Wix>